import BluetoothServer as btserver
import WifiServer as wserver
import WifiClient as wclient
import Wifi
import Database as db
import thread
import time

def WifiServerListeing():
	server = wserver.WifiServer()
	server.Start()
	while(True):
		server.Accept()
		server.Receive()
		server.CloseConnection()

Wifi.getuphosts()
client = wclient.WifiClient()
BT = btserver.BluetoothServer()
BT.Accept()

DB = db.Database("TestDB","test","test")
columns={'message':'varchar(255)','time':'varchar(255)'}
DB.CreateTable('Test_Table',columns, True) #True = Hashable to avoid replications.


try:
   thread.start_new_thread(WifiServerListeing)
except:
   print "Error: unable to start thread"

while(True):
	data = BT.Receive()
	print data + " from Bluetooth!"	
	#attr={'message':str(data),'time':str(time.clock)}
	#DB.Insert('Test_Table',attr)
	#fields,rows=db.SelectAll('Test_Table')
	#print fields + "\n" + rows
	client.Broadcast(Data)
